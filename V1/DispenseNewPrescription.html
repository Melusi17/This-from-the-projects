<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dispense New Prescription</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f6f9;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background-color: #2c3e50;
      height: 100vh;
      padding: 20px;
      color: white;
      position: fixed;
    }

    .sidebar h2 {
      font-size: 20px;
      margin-bottom: 30px;
    }

    .sidebar a {
      color: white;
      text-decoration: none;
      display: block;
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
    }

    .sidebar a:hover {
      background-color: #34495e;
    }

    /* Top Nav */
    .topnav {
      background-color: #ffffff;
      height: 60px;
      line-height: 60px;
      padding: 0 20px;
      position: fixed;
      left: 220px;
      right: 0;
      top: 0;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }

    .topnav span {
      font-weight: bold;
      color: #2c3e50;
    }

    /* Main Content */
    .main-content {
      margin-left: 220px;
      margin-top: 60px;
      padding: 30px;
      width: calc(100% - 220px);
    }

    h2 {
      margin-bottom: 20px;
      color: #2c3e50;
    }

    .section {
      margin-bottom: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .section-title {
      font-weight: 600;
      margin-bottom: 15px;
      color: #34495e;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
    }

    textarea {
      resize: vertical;
      height: 80px;
    }

    .alert {
      background-color: #ffe6e6;
      color: #c0392b;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
      border: 1px solid #e74c3c;
    }

    .btn {
      padding: 12px 20px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .btn:hover {
      background-color: #2980b9;
    }

    .medication-group hr {
      margin-top: 20px;
    }

    /* Updated PDF Section Styles */
    .pdf-section {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .pdf-action {
      flex: 1;
      min-width: 250px;
    }

    .file-input-wrapper {
      margin-top: 8px;
    }

    .file-input-label {
      display: inline-block;
      padding: 8px 12px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

    .file-input-label:hover {
      background-color: #e0e0e0;
    }

    /* New Medication Table Styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #f2f2f2;
    }

    .rejected-row {
      opacity: 0.5;
      background-color: #ffe6e6 !important;
    }

    /* Rejection Popup Styles */
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }

    .reject-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      z-index: 1001;
      width: 400px;
      max-width: 90%;
    }

    .action-btn {
      cursor: pointer;
      margin-right: 10px;
    }

    .reject-btn {
      color: #e74c3c;
    }

    .delete-btn {
      color: #c0392b;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Pharmacist Panel</h2>
    <a href="/Pharmacist/Dashboard">Dashboard</a>
    <a href="/Pharmacist/Dispensory">Dispensory</a>
    <a href="/Pharmacist/Prescriptions">Prescriptions</a>
    <a href="/Pharmacist/Orders">Order Stock</a>
    <a href="/Account/Logout">Logout</a>
  </div>

  <!-- Top Nav -->
  <div class="topnav">
    <span>Dispense New Prescription</span>
    <div>Welcome, Pharmacist</div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <h2>Prescription Details</h2>

    <!-- Patient Info -->
    <div class="section">
      <div class="section-title">Patient Information</div>
      <div class="form-group">
        <label>Patient ID Number:</label>
        <input type="text" name="PatientID" value="1234567890123" readonly>
      </div>
      <div class="form-group">
        <label>Patient Name:</label>
        <input type="text" name="PatientName" value="Jane Doe" readonly>
      </div>
      <div class="form-group">
        <label>Known Allergies:</label>
        <input type="text" value="Penicillin" readonly>
      </div>
    </div>

    <!-- Alert -->
    <div class="alert">
      ‚ö†Ô∏è Warning: This patient is allergic to Penicillin.
    </div>

    <!-- Prescription Info -->
    <div class="section">
      <div class="section-title">Prescription Info</div>
      <div class="form-group">
        <label>Prescription Date:</label>
        <input type="text" value="2025-03-01" readonly>
      </div>
      <div class="form-group">
        <label>Doctor:</label>
        <input type="text" value="Dr. Smith (PR1234567)" readonly>
      </div>
    </div>

    <!-- Updated Medications Section -->
    <div class="section">
      <div class="section-title">Medications</div>

      <table>
        <thead>
          <tr>
            <th>Medication</th>
            <th>Quantity</th>
            <th>Price (ZAR)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Paracetamol 500mg</td>
            <td>10</td>
            <td>
              <input type="number" value="25.99" min="0" step="0.01" style="width: 80px;">
            </td>
            <td>
              <span class="action-btn reject-btn" onclick="rejectMedication(this)">‚ùå Reject</span>
              <span class="action-btn delete-btn" onclick="deleteMedication(this)">üóëÔ∏è Delete</span>
            </td>
          </tr>
          <tr>
            <td>Ibuprofen 200mg</td>
            <td>5</td>
            <td>
              <input type="number" value="32.50" min="0" step="0.01" style="width: 80px;">
            </td>
            <td>
              <span class="action-btn reject-btn" onclick="rejectMedication(this)">‚ùå Reject</span>
              <span class="action-btn delete-btn" onclick="deleteMedication(this)">üóëÔ∏è Delete</span>
            </td>
          </tr>
          <tr>
            <td>Amoxicillin 250mg</td>
            <td>15</td>
            <td>
              <input type="number" value="45.75" min="0" step="0.01" style="width: 80px;">
            </td>
            <td>
              <span class="action-btn reject-btn" onclick="rejectMedication(this)">‚ùå Reject</span>
              <span class="action-btn delete-btn" onclick="deleteMedication(this)">üóëÔ∏è Delete</span>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Add Medication Button -->
      <button class="btn" style="margin-bottom: 20px;">+ Add Medication</button>

      <!-- Instructions -->
      <div class="form-group">
        <label>Instructions:</label>
        <textarea placeholder="e.g., Take one tablet every 8 hours after meals"></textarea>
      </div>

      <!-- Total Price -->
      <div class="form-group" style="text-align: right; font-weight: bold; font-size: 18px;">
        Total: R <span id="totalPrice">104.24</span>
      </div>
    </div>

    <!-- PDF Section -->
    <div class="section">
      <div class="section-title">Prescription PDF</div>
      <div class="pdf-section">
        <div class="pdf-action">
          <div class="form-group">
            <label>Download Prescription:</label>
            <a href="/Files/Prescriptions/prescription123.pdf" class="btn" download>Download PDF</a>
          </div>
        </div>
        <div class="pdf-action">
          <div class="form-group">
            <label>Upload Updated Prescription (PDF only):</label>
            <div class="file-input-wrapper">
              <input type="file" id="prescription-upload" accept=".pdf" style="display: none;">
              <label for="prescription-upload" class="file-input-label">Choose File</label>
              <span id="file-name">No file chosen</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dispense Button -->
    <div class="form-group" style="margin-top: 20px;">
      <button class="btn">Dispense Medication</button>
    </div>
  </div>

  <!-- Rejection Popup Overlay -->
  <div id="popupOverlay" class="popup-overlay"></div>

  <!-- Rejection Popup -->
  <div id="rejectPopup" class="reject-popup" style="display: none;">
    <h3 style="margin-bottom: 15px;">Reject Medication</h3>
    <p style="margin-bottom: 15px;">Select rejection reason:</p>
    
    <div style="margin-bottom: 20px;">
      <input type="radio" id="reason1" name="rejectReason" value="Out of stock">
      <label for="reason1">Out of stock</label><br>
      
      <input type="radio" id="reason2" name="rejectReason" value="Patient allergic">
      <label for="reason2">Patient allergic</label><br>
      
      <input type="radio" id="reason3" name="rejectReason" value="Patient already has it">
      <label for="reason3">Patient already has it</label>
    </div>
    
    <div style="margin-bottom: 10px;">
      <label>Additional Notes:</label>
      <textarea id="rejectNotes" style="width: 100%; height: 60px;"></textarea>
    </div>
    
    <button onclick="confirmRejection()" class="btn" style="background-color: #e74c3c;">Confirm Rejection</button>
    <button onclick="closePopup()" class="btn" style="background-color: #95a5a6; margin-left: 10px;">Cancel</button>
  </div>

  <script>
    // Track which medication is being rejected
    let currentRejectionRow = null;

    // Reject medication function
    function rejectMedication(element) {
      currentRejectionRow = element.closest('tr');
      document.getElementById('popupOverlay').style.display = 'block';
      document.getElementById('rejectPopup').style.display = 'block';
    }

    // Confirm rejection
    function confirmRejection() {
      const reason = document.querySelector('input[name="rejectReason"]:checked');
      const notes = document.getElementById('rejectNotes').value;
      
      if (!reason) {
        alert("Please select a rejection reason");
        return;
      }
      
      currentRejectionRow.classList.add('rejected-row');
      currentRejectionRow.querySelector('.reject-btn').style.display = 'none';
      
      // Add rejection note as data attribute
      currentRejectionRow.setAttribute('data-rejection-reason', reason.value);
      currentRejectionRow.setAttribute('data-rejection-notes', notes);
      
      closePopup();
      calculateTotal();
    }

    // Close popup
    function closePopup() {
      document.getElementById('popupOverlay').style.display = 'none';
      document.getElementById('rejectPopup').style.display = 'none';
      document.getElementById('rejectNotes').value = '';
      const radios = document.querySelectorAll('input[name="rejectReason"]');
      radios.forEach(radio => radio.checked = false);
    }

    // Delete medication
    function deleteMedication(element) {
      if(confirm("Are you sure you want to delete this medication?")) {
        element.closest('tr').remove();
        calculateTotal();
      }
    }

    // Calculate total price
    function calculateTotal() {
      let total = 0;
      const rows = document.querySelectorAll('table tbody tr');
      
      rows.forEach(row => {
        if (!row.classList.contains('rejected-row')) {
          const priceInput = row.querySelector('input[type="number"]');
          if (priceInput) {
            total += parseFloat(priceInput.value) || 0;
          }
        }
      });
      
      document.getElementById('totalPrice').textContent = total.toFixed(2);
    }

    // Initialize price calculation and input events
    document.addEventListener('DOMContentLoaded', function() {
      calculateTotal();
      
      // Update total when prices change
      const priceInputs = document.querySelectorAll('table input[type="number"]');
      priceInputs.forEach(input => {
        input.addEventListener('change', calculateTotal);
      });
    });

    // Show selected file name
    document.getElementById('prescription-upload').addEventListener('change', function(e) {
      const fileName = e.target.files[0] ? e.target.files[0].name : 'No file chosen';
      document.getElementById('file-name').textContent = fileName;
    });
  </script>
</body>
</html>